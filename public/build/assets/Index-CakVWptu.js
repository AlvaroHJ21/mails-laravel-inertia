import{r as G,j as u,y as S}from"./app-2qTt9hAU.js";import{T as L}from"./TextEditable-c6msOAnM.js";import I from"./FilterGroups-DahIZH8D.js";import y from"./Preview-RaRMdMtM.js";import"./FilterGroupTable-C8083YgT.js";const T=[{attr:"edad_grupo",text:"Edad",filters:[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],count:0},{attr:"sexo",text:"Género",filters:[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],count:0},{attr:"estado_civil",text:"Estado Civil",filters:[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],count:0},{attr:"generacion",text:"Generaciones",filters:[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}],count:0}];function M(v){const{segmento:l,departamentos:w,provincias:A,distritos:N}=v,[f,h]=G.useState(T),[a,m]=G.useState([]),E=G.useMemo(()=>{let n=[];return n=l.personas.filter(i=>a.every(r=>{const e=i[r.attr];return r.filters.some(o=>o.value.toLowerCase()===e.toString().toLowerCase())})),n.length},[a]);function b(n,i){const r=a.find(e=>e.attr===n.attr);if(r){if(r.filters.length==1&&r.filters[0].value===i.value){let s=[...a];s=s.filter(c=>c.attr!==n.attr),r.attr==="provincia"&&(s=s.filter(c=>c.attr!=="distrito")),r.attr==="departamento"&&(s=s.filter(c=>c.attr!=="provincia"&&c.attr!=="distrito")),m(s);return}let e=[...r.filters];e.find(s=>s.value===i.value)?e=e.filter(s=>s.value!==i.value):e=[...e,i];const C={...r,filters:e};let x=a.map(s=>s.attr===n.attr?C:s);x=F(x),m(x)}else{const e={attr:n.attr,text:n.text,filters:[i],count:0};let o=[...a,e];o=F(o),m(o)}}function F(n){return n.map(i=>({...i,count:l.personas.filter(r=>i.filters.some(e=>r[i.attr].toString().toLowerCase()===e.value.toLowerCase())).length}))}function j(n,i){return a.some(r=>r.attr===n.attr?r.filters.some(e=>e.value===i.value):!1)}function D(){m(l.filtros)}function p(){m([])}function g(){const n={attr:"departamento",count:0,filters:w.map(t=>({id:t.id,text:t.name,value:t.name})),text:"Departamento"},i=a.find(t=>t.attr==="departamento"),r=i?i.filters.map(t=>t.id):[],e={attr:"provincia",count:0,filters:A.filter(t=>r.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name})),text:"Provincia",table:!0},o=a.find(t=>t.attr==="provincia"),C=o?o.filters.map(t=>t.id):[],x={attr:"distrito",count:0,filters:N.filter(t=>C.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name})),text:"Distrito",table:!0},s=f.find(t=>t.attr==="departamento"),c=f.find(t=>t.attr==="provincia"),O=f.find(t=>t.attr==="distrito");let d=[...f];s||d.push(n),c||d.push(e),O||d.push(x),d=d.map(t=>t.attr==="departamento"?n:t.attr==="provincia"?e:t.attr==="distrito"?x:t),d=F(d),h(d)}return{allfiltersGroups:f,activeFilterGroups:a,handleToggleActiveFilter:b,isFilterActive:j,loadFilterGroups:D,resetFilters:p,totalByAllActiveFilters:E,updateAllFilters:g}}function z(v){const{segmento:l,onSaved:w}=v,[A,N]=G.useState(l.nombre),{allfiltersGroups:f,activeFilterGroups:h,handleToggleActiveFilter:a,isFilterActive:m,loadFilterGroups:E,resetFilters:b,totalByAllActiveFilters:F,updateAllFilters:j}=M({segmento:l,departamentos:v.departamentos,provincias:v.provincias,distritos:v.distritos});G.useEffect(()=>(console.log("update..."),j(),()=>{}),[h]),G.useEffect(()=>(E(),()=>{}),[l]);function D(p){S.put(route("segmentos.update",{segmento:l}),{nombre:p})}return u.jsxs("div",{className:"p-10 bg-gray-100",children:[u.jsx("h1",{className:"title",children:"Generación de Segmentos"}),u.jsx("div",{className:"flex items-center justify-center gap-2 p-4 mb-4 text-white rounded-full bg-azul-marino",children:u.jsx(L,{value:A,onClickOutside:p=>{N(p),A!==p&&D(p)}})}),u.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[u.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg",children:u.jsx(I,{allfiltersGroups:f,handleToggleActiveFilter:a,isFilterActive:m,resetFilters:b})}),u.jsx("div",{className:"flex flex-col pb-8 md:w-[400px]",children:u.jsx(y,{segmento:l,activeFilterGroups:h,totalByAllActiveFilters:F,onSaved:w})})]})]})}export{z as default};
