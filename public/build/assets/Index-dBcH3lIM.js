import{r as F,j as u,y as h}from"./app-DIJI9IXd.js";import{T as w}from"./TextEditable-VhKL8WHI.js";import L from"./FilterGroups-DFnPn9Ki.js";import E from"./Preview-D_nIz3Id.js";import"./FilterGroupTable-IGySxpjP.js";const N=[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],b=[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],j=[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],S=[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}];function f(m){const{attr:r,initialFilters:p,text:x,table:g,segmento:o}=m,[n,c]=F.useState(p),[a,l]=F.useState([]),s=F.useMemo(()=>o.personas.filter(v=>a.some(e=>e.value.toLowerCase()===v[r].toString().toLowerCase())).length,[o,a]);function d(v){a.some(e=>e.id===v.id)?l(e=>e.filter(i=>i.id!==v.id)):l(e=>[...e,v])}function A(v){return a.some(e=>e.id===v.id)}function C(){l([])}return{attr:r,text:x,table:g,allFilter:n,activeFilters:a,partialCount:s,handleToggleActiveFilter:d,isActiveFilter:A,setAllFilter:c,setActiveFilters:l,resetFilters:C}}function G(m){const{segmento:r,departamentos:p,provincias:x,distritos:g}=m,o=f({attr:"edad_grupo",initialFilters:N,text:"Edad",segmento:r}),n=f({attr:"sexo",initialFilters:b,text:"Género",segmento:r}),c=f({attr:"estado_civil",initialFilters:j,text:"Estado Civil",segmento:r}),a=f({attr:"generacion",initialFilters:S,text:"Generaciones",segmento:r}),l=f({attr:"departamento",initialFilters:p.map(e=>({id:e.id,text:e.name,value:e.name})),text:"Departamentos",segmento:r}),s=f({attr:"provincia",initialFilters:[],text:"Provincias",table:!0,segmento:r}),d=f({attr:"distrito",initialFilters:[],text:"Distritos",table:!0,segmento:r}),A=F.useMemo(()=>{let e=[...r.personas];return o.activeFilters.length>0&&(e=e.filter(i=>o.activeFilters.some(t=>t.value.toLowerCase()===i.edad_grupo.toLowerCase()))),n.activeFilters.length>0&&(e=e.filter(i=>n.activeFilters.some(t=>t.value.toLowerCase()===i.sexo.toLowerCase()))),c.activeFilters.length>0&&(e=e.filter(i=>c.activeFilters.some(t=>t.value.toLowerCase()===i.estado_civil.toLowerCase()))),a.activeFilters.length>0&&(e=e.filter(i=>a.activeFilters.some(t=>t.value.toLowerCase()===i.generacion.toLowerCase()))),l.activeFilters.length>0&&(e=e.filter(i=>l.activeFilters.some(t=>t.value.toLowerCase()===i.departamento.toLowerCase()))),s.activeFilters.length>0&&(e=e.filter(i=>s.activeFilters.some(t=>t.value.toLowerCase()===i.provincia.toLowerCase()))),d.activeFilters.length>0&&(e=e.filter(i=>d.activeFilters.some(t=>t.value.toLowerCase()===i.distrito.toLowerCase()))),e.length},[o.activeFilters,n.activeFilters,c.activeFilters,a.activeFilters,l.activeFilters,s.activeFilters]);F.useEffect(()=>{const e=l.activeFilters.map(t=>t.id);let i=x.filter(t=>e.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return s.setAllFilter(i),()=>{}},[l.activeFilters]),F.useEffect(()=>{const e=s.activeFilters.map(t=>t.id);let i=g.filter(t=>e.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return d.setAllFilter(i),()=>{}},[s.activeFilters]),F.useEffect(()=>(l.activeFilters.length===0&&(s.resetFilters(),d.resetFilters()),()=>{}),[l.activeFilters]);function C(){r.filtros.forEach(e=>{e.attr==="edad_grupo"&&o.setActiveFilters(e.filters),e.attr==="sexo"&&n.setActiveFilters(e.filters),e.attr==="estado_civil"&&c.setActiveFilters(e.filters),e.attr==="generacion"&&a.setActiveFilters(e.filters),e.attr==="departamento"&&l.setActiveFilters(e.filters),e.attr==="provincia"&&s.setActiveFilters(e.filters),e.attr==="distrito"&&d.setActiveFilters(e.filters)})}function v(){o.resetFilters(),n.resetFilters(),c.resetFilters(),a.resetFilters(),l.resetFilters(),s.resetFilters(),d.resetFilters()}return{loadFilterGroups:C,resetFilters:v,totalByAllActiveFilters:A,filters:[o,n,c,a,l,s,d]}}function M(m){const{segmento:r,onSaved:p}=m,[x,g]=F.useState(r.nombre),{loadFilterGroups:o,resetFilters:n,totalByAllActiveFilters:c,filters:a}=G({segmento:r,departamentos:m.departamentos,provincias:m.provincias,distritos:m.distritos});F.useEffect(()=>(o(),()=>{}),[r]);function l(s){h.put(route("segmentos.update",{segmento:r}),{nombre:s})}return u.jsxs("div",{className:"px-10 py-4 bg-gray-100",children:[u.jsx("h1",{className:"title",children:"Generación de Segmentos"}),u.jsx("div",{className:"flex items-center justify-center gap-2 p-2 mb-4 text-white rounded-full bg-azul-marino",children:u.jsx(w,{value:x,onClickOutside:s=>{g(s),x!==s&&l(s)}})}),u.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[u.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg max-h-[500px] overflow-y-auto",children:u.jsx(L,{filterGroups:a,resetFilters:n})}),u.jsx("div",{className:"flex flex-col pb-8 md:w-[400px] max-h-[500px] overflow-y-auto",children:u.jsx(E,{segmento:r,filters:a,totalByAllActiveFilters:c,onSaved:p})})]})]})}export{M as default};
