import{r as f}from"./app-CdvNrMoP.js";const O=[{id:1,text:"15-24",value:"JOVEN"},{id:2,text:"25-44",value:"ADULTO"},{id:3,text:"45-59",value:"ADULTO MAYOR"},{id:4,text:"+60",value:"TERCERA EDAD"}],D=[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],I=[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],L=[{id:1,text:"Generación Alpha",value:"GENERACIÓN ALPHA"},{id:2,text:"Generación Z",value:"GENERACIÓN Z"},{id:3,text:"Millennials",value:"MILLENNIALS"},{id:4,text:"Generación X",value:"GENERACIÓN X"},{id:5,text:"Boomers",value:"BOOMERS"},{id:6,text:"Silenciosa",value:"GENERACIÓN SILENCIOSA"}];function b(u,o){if(u===null||o===null||u==null||o===void 0||u===""||o==="")return!1;const c=u.toString().replace("Ã‘","Ñ").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),d=o.toString().replace("Ã‘","Ñ").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return c===d}function E(u,o){let c=[...u.personas];return o.forEach(d=>{d.filters.length>0&&(c=c.filter(m=>d.filters.some(p=>b(m[d.attr],p.value))))}),c.length}function G(u){return u.filter((c,d,m)=>m.indexOf(c)===d&&c!==null)}function V(u){const{segmento:o,departamentos:c,provincias:d,distritos:m}=u,[p,x]=f.useState([]),[n,v]=f.useState([]),F=f.useMemo(()=>{let t=[...n],r=[];for(let i=0;i<t.length;i++)r.push(E(o,t.slice(0,i+1)));return console.log(r),r},[n]),A=f.useMemo(()=>E(o,n),[n]);f.useEffect(()=>(x([{attr:"edad_grupo",filters:O,text:"Edad"},{attr:"estado_civil",filters:I,text:"Estado Civil"},{attr:"sexo",filters:D,text:"Género"},{attr:"generacion",filters:L,text:"Generación"},{attr:"departamento",filters:c.map(t=>({id:t.id,text:t.name,value:t.name})),text:"Departamento"},{attr:"provincia",filters:[],text:"Provincia",table:!0},{attr:"distrito",filters:[],text:"Distrito",table:!0},{attr:"var1",filters:G(o.personas.map(t=>t.var1)).map(t=>({id:t,text:t,value:t})),text:"Variable 1",table:!0},{attr:"var2",filters:G(o.personas.map(t=>t.var2)).map(t=>({id:t,text:t,value:t})),text:"Variable 2",table:!0},{attr:"var3",filters:G(o.personas.map(t=>t.var3)).map(t=>({id:t,text:t,value:t})),text:"Variable 3",table:!0}]),()=>{}),[]),f.useEffect(()=>(v(o.filtros),()=>{}),[o]),f.useEffect(()=>{console.log("cambio en departamentos");const t=n.find(r=>r.attr==="departamento");if(t){const r=t.filters.map(e=>e.id),i=d.filter(e=>r.includes(e.department_id)).map(e=>({id:e.id,text:e.name,value:e.name}));p.find(e=>e.attr==="provincia")&&x(e=>e.map(l=>l.attr==="provincia"?{...l,filters:i}:l));const a=n.find(e=>e.attr==="provincia");v(a?e=>e.map(l=>l.attr==="provincia"?{...l,filters:i}:l):e=>[...e,{attr:"provincia",text:"Provincia",filters:i}])}else p.find(i=>i.attr==="provincia")&&x(i=>i.map(s=>s.attr==="provincia"?{...s,filters:[]}:s));return()=>{}},[n.find(t=>t.attr==="departamento")]),f.useEffect(()=>{const t=n.find(r=>r.attr==="provincia");if(t){const r=t.filters.map(a=>a.id),i=m.filter(a=>r.includes(a.province_id)).map(a=>({id:a.id,text:a.name,value:a.name}));p.find(a=>a.attr==="distrito")&&x(a=>a.map(e=>e.attr==="distrito"?{...e,filters:i}:e))}else p.find(i=>i.attr==="distrito")&&x(i=>i.map(s=>s.attr==="distrito"?{...s,filters:[]}:s));return()=>{}},[n.find(t=>t.attr==="provincia")]);function C(){v([])}function S(t,r){return n.some(i=>i.attr===t.attr&&i.filters.some(s=>s.id===r.id))}function N(t,r){const i=n.find(s=>s.attr===t.attr);if(i){const s=i.filters.find(e=>e.id===r.id),a={...i};s?a.filters=a.filters.filter(e=>e.id!==r.id):a.filters=[...a.filters,{...r}],a.filters.length===0?v(e=>e.filter(l=>l.attr!==t.attr)):v(e=>e.map(l=>l.attr===t.attr?a:l))}else v(s=>[...s,{...t,filters:[r]}])}return{allFilterGroups:p,activeFilterGroups:n,partialCounts:F,totalCount:A,resetFilters:C,isFilterActive:S,toogleFilter:N}}export{V as default};
