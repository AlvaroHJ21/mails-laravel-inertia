import{r as x,j as c,y as O}from"./app-Bqmz_ksN.js";import{T as S}from"./TextEditable-CM0q9bXF.js";import L from"./FilterGroups-9d_8XHII.js";import I from"./Preview-CcwJYt_c.js";import"./FilterGroupTable-BYaYaYRi.js";const y=[{attr:"edad_grupo",text:"Edad",filters:[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],count:0},{attr:"sexo",text:"Género",filters:[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],count:0},{attr:"estado_civil",text:"Estado Civil",filters:[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],count:0},{attr:"generacion",text:"Generaciones",filters:[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}],count:0}];function T(v){const{segmento:l,departamentos:G,provincias:F,distritos:h}=v,[n,d]=x.useState(y),[a,f]=x.useState([]),N=x.useMemo(()=>{let i=[];return i=l.personas.filter(r=>a.every(s=>{const e=r[s.attr];return s.filters.some(u=>u.value.toLowerCase()===e.toString().toLowerCase())})),i.length},[a]);function E(i,r){const s=a.find(e=>e.attr===i.attr);if(s){if(s.filters.length==1&&s.filters[0].value===r.value){f(a.filter(o=>o.attr!==i.attr));return}let e=[...s.filters];e.find(o=>o.value===r.value)?e=e.filter(o=>o.value!==r.value):e=[...e,r];const j={...s,filters:e};let p=a.map(o=>o.attr===i.attr?j:o);p=A(p),f(p)}else{const e={attr:i.attr,text:i.text,filters:[r],count:0};let u=[...a,e];u=A(u),f(u)}}function A(i){return i.map(r=>({...r,count:l.personas.filter(s=>r.filters.some(e=>s[r.attr].toString().toLowerCase()===e.value.toLowerCase())).length}))}function b(i,r){return a.some(s=>s.attr===i.attr?s.filters.some(e=>e.value===r.value):!1)}function g(){f(l.filtros)}function m(){f([])}function w(){console.log(G);const i={attr:"departamento",count:0,filters:G.map(t=>({id:t.id,text:t.name,value:t.name})),text:"Departamento"},r=a.find(t=>t.attr==="departamento"),s=r?r.filters.map(t=>t.id):[],e={attr:"provincia",count:0,filters:F.filter(t=>s.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name})),text:"Provincia",table:!0},u=a.find(t=>t.attr==="provincia"),j=u?u.filters.map(t=>t.id):[],p={attr:"distrito",count:0,filters:h.filter(t=>j.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name})),text:"Distrito",table:!0},o=n.some(t=>t.attr==="departamento"),D=n.some(t=>t.attr==="provincia"),C=n.some(t=>t.attr==="distrito");o||d([...n,i]),D||d([...n,e]),C||d([...n,p]),d(n.map(t=>t.attr==="departamento"?i:t.attr==="provincia"?e:t.attr==="distrito"?p:t))}return{allfiltersGroups:n,activeFilterGroups:a,handleToggleActiveFilter:E,isFilterActive:b,loadFilterGroups:g,resetFilters:m,totalByAllActiveFilters:N,updateAllFilters:w}}function _(v){const{segmento:l,onSaved:G}=v,[F,h]=x.useState(l.nombre),{allfiltersGroups:n,activeFilterGroups:d,handleToggleActiveFilter:a,isFilterActive:f,loadFilterGroups:N,resetFilters:E,totalByAllActiveFilters:A,updateAllFilters:b}=T({segmento:l,departamentos:v.departamentos,provincias:v.provincias,distritos:v.distritos});x.useEffect(()=>(console.log("update..."),b(),()=>{}),[d]),x.useEffect(()=>(N(),()=>{}),[l]);function g(m){O.put(route("segmentos.update",{segmento:l}),{nombre:m})}return c.jsxs("div",{className:"p-10 bg-gray-100",children:[c.jsx("h1",{className:"title",children:"Generación de Segmentos"}),c.jsx("div",{className:"flex items-center justify-center gap-2 p-4 mb-4 text-white rounded-full bg-azul-marino",children:c.jsx(S,{value:F,onClickOutside:m=>{h(m),F!==m&&g(m)}})}),c.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[c.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg",children:c.jsx(L,{allfiltersGroups:n,handleToggleActiveFilter:a,isFilterActive:f,resetFilters:E})}),c.jsx("div",{className:"flex flex-col pb-8 md:w-[400px]",children:c.jsx(I,{segmento:l,activeFilterGroups:d,totalByAllActiveFilters:A,onSaved:G})})]})]})}export{_ as default};
