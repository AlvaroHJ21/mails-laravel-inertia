import{r as m,j as x,y as O}from"./app-D1MufVE4.js";import{T as j}from"./TextEditable-BJHx4eAA.js";import S from"./FilterGroups-C6BvQX7m.js";import G from"./Preview-EwhsHAod.js";import"./FilterGroupTable-CD5AL8vA.js";const V=[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],y=[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],D=[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],I=[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}];function F(p){const{attr:r,initialFilters:A,text:g,table:C,segmento:c}=p,[u,v]=m.useState(A),[o,a]=m.useState([]),l=m.useMemo(()=>c.personas.filter(n=>o.some(d=>n[r]&&d.value.toLowerCase()===n[r].toString().toLowerCase())).length,[c,o]);function f(n){o.some(d=>d.id===n.id)?a(d=>d.filter(E=>E.id!==n.id)):a(d=>[...d,n])}function h(n){return o.some(d=>d.id===n.id)}function w(){a([])}return{attr:r,text:g,table:C,allFilter:u,activeFilters:o,partialCount:l,handleToggleActiveFilter:f,isActiveFilter:h,setAllFilter:v,setActiveFilters:a,resetFilters:w}}function _(p){const{segmento:r,departamentos:A,provincias:g,distritos:C}=p,c=F({attr:"edad_grupo",initialFilters:V,text:"Edad",segmento:r}),u=F({attr:"sexo",initialFilters:y,text:"Género",segmento:r}),v=F({attr:"estado_civil",initialFilters:D,text:"Estado Civil",segmento:r}),o=F({attr:"generacion",initialFilters:I,text:"Generaciones",segmento:r}),a=F({attr:"departamento",initialFilters:A.map(e=>({id:e.id,text:e.name,value:e.name})),text:"Departamentos",segmento:r}),l=F({attr:"provincia",initialFilters:[],text:"Provincias",table:!0,segmento:r}),f=F({attr:"distrito",initialFilters:[],text:"Distritos",table:!0,segmento:r}),h=F({attr:"var1",initialFilters:[],text:"Variable 1",table:!0,segmento:r}),w=F({attr:"var2",initialFilters:[],text:"Variable 2",table:!0,segmento:r}),n=F({attr:"var3",initialFilters:[],text:"Variable 3",table:!0,segmento:r});m.useEffect(()=>{const e=r.personas.map(i=>i.var1).filter((i,L,b)=>b.indexOf(i)===L&&i!==null);h.setAllFilter(e.map(i=>({id:i,text:i,value:i})));const s=r.personas.map(i=>i.var2).filter((i,L,b)=>b.indexOf(i)===L&&i!==null);w.setAllFilter(s.map(i=>({id:i,text:i,value:i})));const t=r.personas.map(i=>i.var3).filter((i,L,b)=>b.indexOf(i)===L&&i!==null);return n.setAllFilter(t.map(i=>({id:i,text:i,value:i}))),()=>{}},[]);const d=m.useMemo(()=>{let e=[...r.personas];return c.activeFilters.length>0&&(e=e.filter(s=>c.activeFilters.some(t=>t.value.toLowerCase()===s.edad_grupo.toLowerCase()))),u.activeFilters.length>0&&(e=e.filter(s=>u.activeFilters.some(t=>t.value.toLowerCase()===s.sexo.toLowerCase()))),v.activeFilters.length>0&&(e=e.filter(s=>v.activeFilters.some(t=>t.value.toLowerCase()===s.estado_civil.toLowerCase()))),o.activeFilters.length>0&&(e=e.filter(s=>o.activeFilters.some(t=>t.value.toLowerCase()===s.generacion.toLowerCase()))),a.activeFilters.length>0&&(e=e.filter(s=>a.activeFilters.some(t=>t.value.toLowerCase()===s.departamento.toLowerCase()))),l.activeFilters.length>0&&(e=e.filter(s=>l.activeFilters.some(t=>t.value.toLowerCase()===s.provincia.toLowerCase()))),f.activeFilters.length>0&&(e=e.filter(s=>f.activeFilters.some(t=>t.value.toLowerCase()===s.distrito.toLowerCase()))),e.length},[c.activeFilters,u.activeFilters,v.activeFilters,o.activeFilters,a.activeFilters,l.activeFilters]);m.useEffect(()=>{const e=a.activeFilters.map(t=>t.id);let s=g.filter(t=>e.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return l.setAllFilter(s),()=>{}},[a.activeFilters]),m.useEffect(()=>{const e=l.activeFilters.map(t=>t.id);let s=C.filter(t=>e.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return f.setAllFilter(s),()=>{}},[l.activeFilters]),m.useEffect(()=>(a.activeFilters.length===0&&(l.resetFilters(),f.resetFilters()),()=>{}),[a.activeFilters]);function E(){r.filtros.forEach(e=>{e.attr==="edad_grupo"&&c.setActiveFilters(e.filters),e.attr==="sexo"&&u.setActiveFilters(e.filters),e.attr==="estado_civil"&&v.setActiveFilters(e.filters),e.attr==="generacion"&&o.setActiveFilters(e.filters),e.attr==="departamento"&&a.setActiveFilters(e.filters),e.attr==="provincia"&&l.setActiveFilters(e.filters),e.attr==="distrito"&&f.setActiveFilters(e.filters),e.attr==="var1"&&h.setActiveFilters(e.filters),e.attr==="var2"&&w.setActiveFilters(e.filters),e.attr==="var3"&&n.setActiveFilters(e.filters)})}function N(){c.resetFilters(),u.resetFilters(),v.resetFilters(),o.resetFilters(),a.resetFilters(),l.resetFilters(),f.resetFilters()}return{loadFilterGroups:E,resetFilters:N,totalByAllActiveFilters:d,filters:[c,u,v,o,a,l,f,h,w,n]}}function z(p){const{segmento:r,onSaved:A}=p,[g,C]=m.useState(r.nombre),{loadFilterGroups:c,resetFilters:u,totalByAllActiveFilters:v,filters:o}=_({segmento:r,departamentos:p.departamentos,provincias:p.provincias,distritos:p.distritos});m.useEffect(()=>(c(),()=>{}),[r]);function a(l){O.put(route("segmentos.update",{segmento:r}),{nombre:l})}return x.jsxs("div",{className:"px-10 py-4 bg-gray-100",children:[x.jsx("h1",{className:"title",children:"Generación de Segmentos"}),x.jsx("div",{className:"flex items-center justify-center gap-2 p-2 mb-4 text-white rounded-full bg-azul-marino",children:x.jsx(j,{value:g,onClickOutside:l=>{C(l),g!==l&&a(l)}})}),x.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[x.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg max-h-[500px] overflow-y-auto",children:x.jsx(S,{filterGroups:o,resetFilters:u})}),x.jsx("div",{className:"flex flex-col pb-8 md:w-[400px] max-h-[500px] overflow-y-auto",children:x.jsx(G,{segmento:r,filters:o,totalByAllActiveFilters:v,onSaved:A})})]})]})}export{z as default};
