import{r as f,j as x,y as O}from"./app--lcl_kU6.js";import{T as j}from"./TextEditable-DbxWQnpK.js";import S from"./FilterGroups-C2GlVSJK.js";import G from"./Preview-B8MzMYV_.js";import"./FilterGroupTable-hEJQw2Di.js";const V=[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],y=[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],D=[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],I=[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}];function m(p){const{attr:s,initialFilters:w,text:C,table:L,segmento:c}=p,[d,F]=f.useState(w),[o,a]=f.useState([]),l=f.useMemo(()=>c.personas.filter(n=>o.some(v=>n[s]&&v.value.toLowerCase()===n[s].toString().toLowerCase())).length,[c,o]);function u(n){o.some(v=>v.id===n.id)?a(v=>v.filter(E=>E.id!==n.id)):a(v=>[...v,n])}function g(n){return o.some(v=>v.id===n.id)}function A(){a([])}return{attr:s,text:C,table:L,allFilter:d,activeFilters:o,partialCount:l,handleToggleActiveFilter:u,isActiveFilter:g,setAllFilter:F,setActiveFilters:a,resetFilters:A}}function _(p){const{segmento:s,departamentos:w,provincias:C,distritos:L}=p,c=m({attr:"edad_grupo",initialFilters:V,text:"Edad",segmento:s}),d=m({attr:"sexo",initialFilters:y,text:"Género",segmento:s}),F=m({attr:"estado_civil",initialFilters:D,text:"Estado Civil",segmento:s}),o=m({attr:"generacion",initialFilters:I,text:"Generaciones",segmento:s}),a=m({attr:"departamento",initialFilters:w.map(e=>({id:e.id,text:e.name,value:e.name})),text:"Departamentos",segmento:s}),l=m({attr:"provincia",initialFilters:[],text:"Provincias",table:!0,segmento:s}),u=m({attr:"distrito",initialFilters:[],text:"Distritos",table:!0,segmento:s}),g=m({attr:"var1",initialFilters:[],text:"Variable 1",table:!0,segmento:s}),A=m({attr:"var2",initialFilters:[],text:"Variable 2",table:!0,segmento:s}),n=m({attr:"var3",initialFilters:[],text:"Variable 3",table:!0,segmento:s});f.useEffect(()=>{const e=s.personas.map(r=>r.var1).filter((r,h,b)=>b.indexOf(r)===h&&r!==null);g.setAllFilter(e.map(r=>({id:r,text:r,value:r})));const i=s.personas.map(r=>r.var2).filter((r,h,b)=>b.indexOf(r)===h&&r!==null);A.setAllFilter(i.map(r=>({id:r,text:r,value:r})));const t=s.personas.map(r=>r.var3).filter((r,h,b)=>b.indexOf(r)===h&&r!==null);return n.setAllFilter(t.map(r=>({id:r,text:r,value:r}))),()=>{}},[]);const v=f.useMemo(()=>{let e=[...s.personas];return c.activeFilters.length>0&&(e=e.filter(i=>c.activeFilters.some(t=>t.value.toLowerCase()===i.edad_grupo.toLowerCase()))),d.activeFilters.length>0&&(e=e.filter(i=>d.activeFilters.some(t=>t.value.toLowerCase()===i.sexo.toLowerCase()))),F.activeFilters.length>0&&(e=e.filter(i=>F.activeFilters.some(t=>i.estado_civil&&t.value.toLowerCase()===i.estado_civil.toLowerCase()))),o.activeFilters.length>0&&(e=e.filter(i=>o.activeFilters.some(t=>i.generacion&&t.value.toLowerCase()===i.generacion.toLowerCase()))),a.activeFilters.length>0&&(e=e.filter(i=>a.activeFilters.some(t=>i.departamento&&t.value.toLowerCase()===i.departamento.toLowerCase()))),l.activeFilters.length>0&&(e=e.filter(i=>l.activeFilters.some(t=>i.provincia&&t.value.toLowerCase()===i.provincia.toLowerCase()))),u.activeFilters.length>0&&(e=e.filter(i=>u.activeFilters.some(t=>i.distrito&&t.value.toLowerCase()===i.distrito.toLowerCase()))),g.activeFilters.length>0&&(e=e.filter(i=>g.activeFilters.some(t=>i.var1&&t.value.toLowerCase()===i.var1.toLowerCase()))),A.activeFilters.length>0&&(e=e.filter(i=>A.activeFilters.some(t=>i.var2&&t.value.toLowerCase()===i.var2.toLowerCase()))),n.activeFilters.length>0&&(e=e.filter(i=>n.activeFilters.some(t=>i.var3&&t.value.toLowerCase()===i.var3.toLowerCase()))),e.length},[c.activeFilters,d.activeFilters,F.activeFilters,o.activeFilters,a.activeFilters,l.activeFilters,u.activeFilters,g.activeFilters,A.activeFilters,n.activeFilters]);f.useEffect(()=>{const e=a.activeFilters.map(t=>t.id);let i=C.filter(t=>e.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return l.setAllFilter(i),()=>{}},[a.activeFilters]),f.useEffect(()=>{const e=l.activeFilters.map(t=>t.id);let i=L.filter(t=>e.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return u.setAllFilter(i),()=>{}},[l.activeFilters]),f.useEffect(()=>(a.activeFilters.length===0&&(l.resetFilters(),u.resetFilters()),()=>{}),[a.activeFilters]);function E(){s.filtros.forEach(e=>{e.attr==="edad_grupo"&&c.setActiveFilters(e.filters),e.attr==="sexo"&&d.setActiveFilters(e.filters),e.attr==="estado_civil"&&F.setActiveFilters(e.filters),e.attr==="generacion"&&o.setActiveFilters(e.filters),e.attr==="departamento"&&a.setActiveFilters(e.filters),e.attr==="provincia"&&l.setActiveFilters(e.filters),e.attr==="distrito"&&u.setActiveFilters(e.filters),e.attr==="var1"&&g.setActiveFilters(e.filters),e.attr==="var2"&&A.setActiveFilters(e.filters),e.attr==="var3"&&n.setActiveFilters(e.filters)})}function N(){c.resetFilters(),d.resetFilters(),F.resetFilters(),o.resetFilters(),a.resetFilters(),l.resetFilters(),u.resetFilters()}return{loadFilterGroups:E,resetFilters:N,totalByAllActiveFilters:v,filters:[c,d,F,o,a,l,u,g,A,n]}}function z(p){const{segmento:s,onSaved:w}=p,[C,L]=f.useState(s.nombre),{loadFilterGroups:c,resetFilters:d,totalByAllActiveFilters:F,filters:o}=_({segmento:s,departamentos:p.departamentos,provincias:p.provincias,distritos:p.distritos});f.useEffect(()=>(c(),()=>{}),[s]);function a(l){O.put(route("segmentos.update",{segmento:s}),{nombre:l})}return x.jsxs("div",{className:"px-10 py-4 bg-gray-100",children:[x.jsx("h1",{className:"title",children:"Generación de Segmentos"}),x.jsx("div",{className:"flex items-center justify-center gap-2 p-2 mb-4 text-white rounded-full bg-azul-marino",children:x.jsx(j,{value:C,onClickOutside:l=>{L(l),C!==l&&a(l)}})}),x.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[x.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg max-h-[500px] overflow-y-auto",children:x.jsx(S,{filterGroups:o,resetFilters:d})}),x.jsx("div",{className:"flex flex-col pb-8 md:w-[400px] max-h-[500px] overflow-y-auto",children:x.jsx(G,{segmento:s,filters:o,totalByAllActiveFilters:F,onSaved:w})})]})]})}export{z as default};
