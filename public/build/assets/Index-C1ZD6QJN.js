import{r as x,j as u,y as S}from"./app-g_Ga4a36.js";import{T as L}from"./TextEditable-CLY4OeTU.js";import I from"./FilterGroups-BjeyMcHP.js";import y from"./Preview-DWHGd-oN.js";import"./FilterGroupTable-CKFMQrdo.js";const T=[{attr:"edad_grupo",text:"Edad",filters:[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],count:0},{attr:"sexo",text:"Género",filters:[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],count:0},{attr:"estado_civil",text:"Estado Civil",filters:[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],count:0},{attr:"generacion",text:"Generaciones",filters:[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}],count:0}];function M(m){const{segmento:l,departamentos:G,provincias:F,distritos:N}=m,[c,A]=x.useState(T),[n,d]=x.useState([]),w=x.useMemo(()=>{let i=[];return i=l.personas.filter(r=>n.every(s=>{const e=r[s.attr];return s.filters.some(o=>o.value.toLowerCase()===e.toString().toLowerCase())})),i.length},[n]);function E(i,r){const s=n.find(e=>e.attr===i.attr);if(s){if(s.filters.length==1&&s.filters[0].value===r.value){d(n.filter(a=>a.attr!==i.attr));return}let e=[...s.filters];e.find(a=>a.value===r.value)?e=e.filter(a=>a.value!==r.value):e=[...e,r];const j={...s,filters:e};let p=n.map(a=>a.attr===i.attr?j:a);p=h(p),d(p)}else{const e={attr:i.attr,text:i.text,filters:[r],count:0};let o=[...n,e];o=h(o),d(o)}}function h(i){return i.map(r=>({...r,count:l.personas.filter(s=>r.filters.some(e=>s[r.attr].toString().toLowerCase()===e.value.toLowerCase())).length}))}function b(i,r){return n.some(s=>s.attr===i.attr?s.filters.some(e=>e.value===r.value):!1)}function g(){d(l.filtros)}function f(){d([])}function D(){console.log(G);const i={attr:"departamento",count:0,filters:G.map(t=>({id:t.id,text:t.name,value:t.name})),text:"Departamento"},r=n.find(t=>t.attr==="departamento"),s=r?r.filters.map(t=>t.id):[],e={attr:"provincia",count:0,filters:F.filter(t=>s.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name})),text:"Provincia",table:!0},o=n.find(t=>t.attr==="provincia"),j=o?o.filters.map(t=>t.id):[],p={attr:"distrito",count:0,filters:N.filter(t=>j.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name})),text:"Distrito",table:!0},a=c.some(t=>t.attr==="departamento"),C=c.some(t=>t.attr==="provincia"),O=c.some(t=>t.attr==="distrito");let v=[...c];a||v.push(i),C||v.push(e),O||v.push(p),v=v.map(t=>t.attr==="departamento"?i:t.attr==="provincia"?e:t.attr==="distrito"?p:t),A(v)}return{allfiltersGroups:c,activeFilterGroups:n,handleToggleActiveFilter:E,isFilterActive:b,loadFilterGroups:g,resetFilters:f,totalByAllActiveFilters:w,updateAllFilters:D}}function z(m){const{segmento:l,onSaved:G}=m,[F,N]=x.useState(l.nombre),{allfiltersGroups:c,activeFilterGroups:A,handleToggleActiveFilter:n,isFilterActive:d,loadFilterGroups:w,resetFilters:E,totalByAllActiveFilters:h,updateAllFilters:b}=M({segmento:l,departamentos:m.departamentos,provincias:m.provincias,distritos:m.distritos});x.useEffect(()=>(console.log("update..."),b(),()=>{}),[A]),x.useEffect(()=>(w(),()=>{}),[l]);function g(f){S.put(route("segmentos.update",{segmento:l}),{nombre:f})}return u.jsxs("div",{className:"p-10 bg-gray-100",children:[u.jsx("h1",{className:"title",children:"Generación de Segmentos"}),u.jsx("div",{className:"flex items-center justify-center gap-2 p-4 mb-4 text-white rounded-full bg-azul-marino",children:u.jsx(L,{value:F,onClickOutside:f=>{N(f),F!==f&&g(f)}})}),u.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[u.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg",children:u.jsx(I,{allfiltersGroups:c,handleToggleActiveFilter:n,isFilterActive:d,resetFilters:E})}),u.jsx("div",{className:"flex flex-col pb-8 md:w-[400px]",children:u.jsx(y,{segmento:l,activeFilterGroups:A,totalByAllActiveFilters:h,onSaved:G})})]})]})}export{z as default};
