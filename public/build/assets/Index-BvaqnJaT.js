import{r as F,j as v,y as h}from"./app-CsWSfFqG.js";import{T as w}from"./TextEditable-DPWTSHu4.js";import N from"./FilterGroups-C5hbvuga.js";import G from"./Preview-DT34Fn_I.js";import"./FilterGroupTable-C2NfSH1i.js";const O=[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],S=[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],D=[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],I=[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}],b=[{attr:"edad_grupo",text:"Edad",filters:[{id:1,text:"18-25",value:"JOVEN"},{id:2,text:"26-35",value:"ADULTO"},{id:3,text:"36-45",value:"ADULTO MAYOR"}],count:0},{attr:"sexo",text:"Género",filters:[{id:1,text:"Hombres",value:"M"},{id:2,text:"Mujeres",value:"F"}],count:0},{attr:"estado_civil",text:"Estado Civil",filters:[{id:1,text:"Solteros",value:"SOLTERO"},{id:2,text:"Casados",value:"CASADO"},{id:3,text:"Divorciados",value:"DIVORCIADO"},{id:4,text:"Viudos",value:"VIUDO"}],count:0},{attr:"generacion",text:"Generaciones",filters:[{id:1,text:"Generación x",value:"GENERACIÓN X"},{id:2,text:"Millennials",value:"MILLENNIALS"},{id:3,text:"Generación z",value:"GENERACIÓN Z"}],count:0}];function f(x){const{attr:i,initialFilters:g,text:p,table:C,segmento:A}=x,[L,c]=F.useState(g),[s,a]=F.useState([]),l=F.useMemo(()=>A.personas.filter(u=>s.some(n=>n.value.toLowerCase()===u[i].toString().toLowerCase())).length,[A,s]);function d(u){s.some(n=>n.id===u.id)?a(n=>n.filter(E=>E.id!==u.id)):a(n=>[...n,u])}function o(u){return s.some(n=>n.id===u.id)}function m(){a([])}return{attr:i,text:p,table:C,allFilter:L,activeFilters:s,partialCount:l,handleToggleActiveFilter:d,isActiveFilter:o,setAllFilter:c,setActiveFilters:a,resetFilters:m}}function j(x){const{segmento:i,departamentos:g,provincias:p,distritos:C}=x,[A,L]=F.useState(b),c=f({attr:"edad_grupo",initialFilters:O,text:"Edad",segmento:i}),s=f({attr:"sexo",initialFilters:S,text:"Género",segmento:i}),a=f({attr:"estado_civil",initialFilters:D,text:"Estado Civil",segmento:i}),l=f({attr:"generacion",initialFilters:I,text:"Generaciones",segmento:i}),d=f({attr:"departamento",initialFilters:g.map(e=>({id:e.id,text:e.name,value:e.name})),text:"Departamentos",segmento:i}),o=f({attr:"provincia",initialFilters:[],text:"Provincias",table:!0,segmento:i}),m=f({attr:"distrito",initialFilters:[],text:"Distritos",table:!0,segmento:i}),u=F.useMemo(()=>{let e=[...i.personas];return c.activeFilters.length>0&&(e=e.filter(r=>c.activeFilters.some(t=>t.value.toLowerCase()===r.edad_grupo.toLowerCase()))),s.activeFilters.length>0&&(e=e.filter(r=>s.activeFilters.some(t=>t.value.toLowerCase()===r.sexo.toLowerCase()))),a.activeFilters.length>0&&(e=e.filter(r=>a.activeFilters.some(t=>t.value.toLowerCase()===r.estado_civil.toLowerCase()))),l.activeFilters.length>0&&(e=e.filter(r=>l.activeFilters.some(t=>t.value.toLowerCase()===r.generacion.toLowerCase()))),d.activeFilters.length>0&&(e=e.filter(r=>d.activeFilters.some(t=>t.value.toLowerCase()===r.departamento.toLowerCase()))),o.activeFilters.length>0&&(e=e.filter(r=>o.activeFilters.some(t=>t.value.toLowerCase()===r.provincia.toLowerCase()))),m.activeFilters.length>0&&(e=e.filter(r=>m.activeFilters.some(t=>t.value.toLowerCase()===r.distrito.toLowerCase()))),e.length},[c.activeFilters,s.activeFilters,a.activeFilters,l.activeFilters,d.activeFilters,o.activeFilters]);F.useEffect(()=>{const e=d.activeFilters.map(t=>t.id);let r=p.filter(t=>e.includes(t.department_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return o.setAllFilter(r),()=>{}},[d.activeFilters]),F.useEffect(()=>{const e=o.activeFilters.map(t=>t.id);let r=C.filter(t=>e.includes(t.province_id)).map(t=>({id:t.id,text:t.name,value:t.name}));return m.setAllFilter(r),()=>{}},[o.activeFilters]);function n(){i.filtros.forEach(e=>{e.attr==="edad_grupo"&&c.setActiveFilters(e.filters),e.attr==="sexo"&&s.setActiveFilters(e.filters),e.attr==="estado_civil"&&a.setActiveFilters(e.filters),e.attr==="generacion"&&l.setActiveFilters(e.filters),e.attr==="departamento"&&d.setActiveFilters(e.filters),e.attr==="provincia"&&o.setActiveFilters(e.filters),e.attr==="distrito"&&m.setActiveFilters(e.filters)})}function E(){c.resetFilters(),s.resetFilters(),a.resetFilters(),l.resetFilters(),d.resetFilters(),o.resetFilters(),m.resetFilters()}return{allfiltersGroups:A,loadFilterGroups:n,resetFilters:E,totalByAllActiveFilters:u,filters:[c,s,a,l,d,o,m]}}function V(x){const{segmento:i,onSaved:g}=x,[p,C]=F.useState(i.nombre),{loadFilterGroups:A,resetFilters:L,totalByAllActiveFilters:c,filters:s}=j({segmento:i,departamentos:x.departamentos,provincias:x.provincias,distritos:x.distritos});F.useEffect(()=>(A(),()=>{}),[i]);function a(l){h.put(route("segmentos.update",{segmento:i}),{nombre:l})}return v.jsxs("div",{className:"px-10 py-4 bg-gray-100",children:[v.jsx("h1",{className:"title",children:"Generación de Segmentos"}),v.jsx("div",{className:"flex items-center justify-center gap-2 p-2 mb-4 text-white rounded-full bg-azul-marino",children:v.jsx(w,{value:p,onClickOutside:l=>{C(l),p!==l&&a(l)}})}),v.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[v.jsx("div",{className:"flex-1 p-8 bg-white rounded-lg max-h-[500px] overflow-y-auto",children:v.jsx(N,{filterGroups:s,resetFilters:L})}),v.jsx("div",{className:"flex flex-col pb-8 md:w-[400px] max-h-[500px] overflow-y-auto",children:v.jsx(G,{segmento:i,filters:s,totalByAllActiveFilters:c,onSaved:g})})]})]})}export{V as default};
